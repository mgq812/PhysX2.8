<html>
<head>
<title>Physics SDK API Reference: NxPool.h Source File</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<LINK HREF="../stylesheet.css" REL="stylesheet" TYPE="text/css">

</head>

<body bgcolor="#FFFFFF">
<img alt="" src="images/PhysXlogo.png" align="middle"> <br>

<center>

<hr>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp;  </center>
<hr>
<!-- Generated by Doxygen 1.4.6-NO -->
<h1>NxPool.h</h1><a href="NxPool_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef NXPOOL_H</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define NXPOOL_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="comment">/*----------------------------------------------------------------------------*\</span>
<a name="l00004"></a>00004 <span class="comment">|</span>
<a name="l00005"></a>00005 <span class="comment">|                       Public Interface to Ageia PhysX Technology</span>
<a name="l00006"></a>00006 <span class="comment">|</span>
<a name="l00007"></a>00007 <span class="comment">|                                www.ageia.com</span>
<a name="l00008"></a>00008 <span class="comment">|</span>
<a name="l00009"></a>00009 <span class="comment">\*----------------------------------------------------------------------------*/</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="NxArray_8h.html">NxArray.h</a>"</span>
<a name="l00015"></a>00015 
<a name="l00019"></a>00019 <span class="keyword">template</span>&lt;<span class="keyword">class</span> Element, <span class="keywordtype">int</span> ElementSize&gt;
<a name="l00020"></a><a class="code" href="classNxPool.html">00020</a> <span class="keyword">class </span><a class="code" href="classNxPool.html">NxPool</a>
<a name="l00021"></a>00021 {
<a name="l00022"></a><a class="code" href="classNxPool.html#cf005ce81eae84723e9f5c7263ee3723">00022</a>     <span class="keyword">typedef</span> NxArraySDK&lt;Element*&gt; <a class="code" href="classNxPool.html#cf005ce81eae84723e9f5c7263ee3723">ElementPtrArray</a>;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">public</span>:
<a name="l00025"></a>00025 
<a name="l00030"></a><a class="code" href="classNxPool.html#c40f4a008e99cb00a901631e0a2bf610">00030</a>     <a class="code" href="classNxPool.html#c40f4a008e99cb00a901631e0a2bf610">NxPool</a>(NxU32 initial, NxU32 increment = 0)
<a name="l00031"></a>00031     {   
<a name="l00032"></a>00032         <a class="code" href="classNxPool.html#80dc81e05967c7510950d269c5c04b9d">mIncrement</a> = increment;
<a name="l00033"></a>00033         <a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a> = 0;
<a name="l00034"></a>00034         <a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a> = 0;
<a name="l00035"></a>00035         <a class="code" href="classNxPool.html#b4803aa3b5e10da75b1c44fe5c5c7422">allocSlab</a>(initial);
<a name="l00036"></a>00036     }
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="classNxPool.html#d179b6d643b54d02a083e655071bee51">00038</a>     <a class="code" href="classNxPool.html#d179b6d643b54d02a083e655071bee51">~NxPool</a>()
<a name="l00039"></a>00039     {
<a name="l00040"></a>00040         <span class="keywordflow">for</span>(NxU32 i=0;i&lt;<a class="code" href="classNxPool.html#c3263413f5d3cc82ad590fe5ba1a42ba">mSlabArray</a>.size();i++)
<a name="l00041"></a>00041             nxFoundationSDKAllocator-&gt;free(<a class="code" href="classNxPool.html#c3263413f5d3cc82ad590fe5ba1a42ba">mSlabArray</a>[i]);
<a name="l00042"></a>00042     }
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classNxPool.html#56c4c57ade1022784a96c39dcc5d68a1">00045</a>     Element *<a class="code" href="classNxPool.html#56c4c57ade1022784a96c39dcc5d68a1">get</a>()
<a name="l00046"></a>00046     {
<a name="l00047"></a>00047         Element *element = 0;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="keywordflow">if</span>(<a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>==<a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a> &amp;&amp; <a class="code" href="classNxPool.html#80dc81e05967c7510950d269c5c04b9d">mIncrement</a>)            
<a name="l00050"></a>00050             <a class="code" href="classNxPool.html#b4803aa3b5e10da75b1c44fe5c5c7422">allocSlab</a>(<a class="code" href="classNxPool.html#80dc81e05967c7510950d269c5c04b9d">mIncrement</a>);
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keywordflow">if</span>(<a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a> &lt; <a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a>)
<a name="l00053"></a>00053         {
<a name="l00054"></a>00054             element = <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>[<a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>];
<a name="l00055"></a>00055             <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>[element-&gt;hwid] = <a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>++;
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057 <span class="comment">//      printf("Acquired %lp\n",element);</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059         <span class="keywordflow">return</span> element;
<a name="l00060"></a>00060     }
<a name="l00061"></a>00061 
<a name="l00065"></a><a class="code" href="classNxPool.html#4432cc433b483f5a6fca8cfd10b3bf38">00065</a>     <span class="keywordtype">void</span> <a class="code" href="classNxPool.html#4432cc433b483f5a6fca8cfd10b3bf38">put</a>(Element *element)
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067 <span class="comment">//      printf("Releasing %lp\n",element);</span>
<a name="l00068"></a>00068         <span class="keywordflow">if</span>(<a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>[element-&gt;hwid]!=0xffffffff)
<a name="l00069"></a>00069         {
<a name="l00070"></a>00070             NxU32 elementPos = <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>[element-&gt;hwid];
<a name="l00071"></a>00071             <span class="comment">/* swap the released element with the last element &amp; decrement content counter */</span>
<a name="l00072"></a>00072             Element *replacement = <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>[--<a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>];
<a name="l00073"></a>00073             <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>[<a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>] = element;
<a name="l00074"></a>00074             <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>[elementPos] = replacement;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076             <span class="comment">/* update the ID to contents arrays */</span>
<a name="l00077"></a>00077             <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>[replacement-&gt;hwid] = elementPos;
<a name="l00078"></a>00078             <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>[element-&gt;hwid] = 0xffffffff;
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 
<a name="l00082"></a><a class="code" href="classNxPool.html#027c37fde7361fcf13644160c563524f">00082</a>     <span class="keyword">const</span> <a class="code" href="classNxArray.html">NxArray&lt;Element *&gt;</a> <a class="code" href="classNxPool.html#027c37fde7361fcf13644160c563524f">contents</a>() 
<a name="l00083"></a>00083     {
<a name="l00084"></a>00084         <span class="keywordflow">return</span> <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>;
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086     
<a name="l00087"></a><a class="code" href="classNxPool.html#765197502d728d3dc5a7029b04e8e43a">00087</a>     NxU32 <a class="code" href="classNxPool.html#765197502d728d3dc5a7029b04e8e43a">count</a>() 
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="keywordflow">return</span> <a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">mCount</a>;
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keyword">private</span>:
<a name="l00093"></a><a class="code" href="classNxPool.html#b4803aa3b5e10da75b1c44fe5c5c7422">00093</a>     <span class="keywordtype">void</span> <a class="code" href="classNxPool.html#b4803aa3b5e10da75b1c44fe5c5c7422">allocSlab</a>(NxU32 <a class="code" href="classNxPool.html#765197502d728d3dc5a7029b04e8e43a">count</a>)
<a name="l00094"></a>00094     {
<a name="l00095"></a>00095         <span class="keywordtype">char</span> *mem = (<span class="keywordtype">char</span> *)
<a name="l00096"></a>00096             nxFoundationSDKAllocator-&gt;malloc(count * ElementSize);
<a name="l00097"></a>00097         <span class="keywordflow">if</span>(!mem)
<a name="l00098"></a>00098             <span class="keywordflow">return</span>;
<a name="l00099"></a>00099         
<a name="l00100"></a>00100         <a class="code" href="classNxPool.html#c3263413f5d3cc82ad590fe5ba1a42ba">mSlabArray</a>.pushBack(mem);
<a name="l00101"></a>00101         <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>.reserve(<a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a>+count);
<a name="l00102"></a>00102         <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>.reserve(<a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a>+count);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">for</span>(NxU32 i=0;i&lt;count;i++)
<a name="l00105"></a>00105         {
<a name="l00106"></a>00106             Element *e = (Element *)(mem + i * ElementSize);
<a name="l00107"></a>00107             e-&gt;hwid = <a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a>+i;
<a name="l00108"></a>00108             <a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">mIDToContents</a>.pushBack(0xffffffff);
<a name="l00109"></a>00109             <a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">mContents</a>.pushBack(e);
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         <a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">mCapacity</a>+=<a class="code" href="classNxPool.html#765197502d728d3dc5a7029b04e8e43a">count</a>;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="classNxPool.html#80dc81e05967c7510950d269c5c04b9d">00115</a>     NxU32                 mIncrement;     <span class="comment">/* resize quantum */</span>
<a name="l00116"></a><a class="code" href="classNxPool.html#25ecc619c22592df856d34abe08c5e41">00116</a>     NxU32                 mCapacity;      <span class="comment">/* current size */</span>
<a name="l00117"></a><a class="code" href="classNxPool.html#b9b34619c68150cdc21b02051ab59096">00117</a>     NxU32                 mCount;         <span class="comment">/* current number of elements */</span>
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="classNxPool.html#c3263413f5d3cc82ad590fe5ba1a42ba">00119</a>     NxArraySDK&lt;char *&gt; mSlabArray;        <span class="comment">/* array of allocated slabs */</span> 
<a name="l00120"></a>00120 
<a name="l00121"></a><a class="code" href="classNxPool.html#f44f7e27c1afbe41c9a739a0ddce3777">00121</a>     ElementPtrArray mContents;            <span class="comment">/* array of elements. The first mCount are in use, </span>
<a name="l00122"></a>00122 <span class="comment">                                             the rest are free for allocation */</span>
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="classNxPool.html#ea7444be942dc2e92374e176359aa2a7">00124</a>     NxArraySDK&lt;NxU32&gt;     mIDToContents;  <span class="comment">/* maps IDs to the mContents array in order to get O(1) removal. </span>
<a name="l00125"></a>00125 <span class="comment">                                             Only required for things actually allocated, so use 0xffffffff </span>
<a name="l00126"></a>00126 <span class="comment">                                             for 'not allocated' and thereby catch double-deletion. */</span>
<a name="l00127"></a>00127 };
<a name="l00128"></a>00128 
<a name="l00130"></a>00130 <span class="preprocessor">#endif</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><span class="comment">//AGCOPYRIGHTBEGIN</span>
<a name="l00133"></a>00133 <span class="comment"></span><span class="comment">// Copyright (c) 2005 AGEIA Technologies.</span>
<a name="l00134"></a>00134 <span class="comment">// All rights reserved. www.ageia.com</span>
<a name="l00136"></a>00136 <span class="comment"></span><span class="comment">//AGCOPYRIGHTEND</span>
</pre></div>
<hr style="width: 100%; height: 2px;"><a><br>
</a>
Copyright &copy; 2008 NVIDIA Corporation, 2701 San Tomas Expressway, Santa Clara, CA 95050 U.S.A. All rights reserved. <a href="http://www.nvidia.com ">www.nvidia.com</a>
</body>
</html>
